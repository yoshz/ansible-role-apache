<VirtualHost *:{{ apache_listen_port }}>
	ServerName {{ item.value.hostname }}
	{% if item.value.alias is defined %}ServerAlias {{ item.value.alias }}{% endif %}

	ServerAdmin {{ item.value.admin|default('webmaster@localhost') }}
	{% if item.value.virtual_docroot is defined %}VirtualDocumentRoot {{ item.value.virtual_docroot }}
	{% elif item.value.docroot is defined %}DocumentRoot {{ item.value.docroot }}{% endif %}

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

</VirtualHost>

{% if item.value.ssl_keyfile is defined %}
<VirtualHost *:443>
	ServerName {{ item.value.hostname }}
	{% if item.value.alias is defined %}ServerAlias {{ item.value.alias }}{% endif %}

	ServerAdmin {{ item.value.admin|default('webmaster@localhost') }}
	{% if item.value.virtual_docroot is defined %}VirtualDocumentRoot {{ item.value.virtual_docroot }}
	{% elif item.value.docroot is defined %}DocumentRoot {{ item.value.docroot }}{% endif %}

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	SSLEngine on
	SSLCertificateFile /etc/apache2/ssl/{{ item.key }}.crt
	SSLCertificateKeyFile /etc/apache2/ssl/{{ item.key }}.key

</VirtualHost>
{% endif %}